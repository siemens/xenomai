<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Xenomai: Dynamic memory allocation services</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Xenomai"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xenomai
   &#160;<span id="projectnumber">3.0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__cobalt__core__heap.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Dynamic memory allocation services<div class="ingroups"><a class="el" href="group__cobalt.html">Cobalt</a> &raquo; <a class="el" href="group__cobalt__core.html">Cobalt kernel</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The implementation of the memory allocator follows the algorithm described in a USENIX 1988 paper called "Design of a General
 Purpose Memory Allocator for the 4.3BSD Unix Kernel" by Marshall K.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Dynamic memory allocation services:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__cobalt__core__heap.png" border="0" alt="" usemap="#group____cobalt____core____heap"/>
<map name="group____cobalt____core____heap" id="group____cobalt____core____heap">
<area shape="rect" id="node2" href="group__cobalt__core.html" title="The Cobalt core is a co&#45;kernel which supplements the Linux kernel for delivering real&#45;time services w..." alt="" coords="5,13,104,39"/>
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structxnheap_1_1xnbucket.html">xnheap::xnbucket</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">log2 bucket list  <a href="structxnheap_1_1xnbucket.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga3772bba609e1cd11cb1a5d783113a6aa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cobalt__core__heap.html#ga3772bba609e1cd11cb1a5d783113a6aa">xnheap_init</a> (struct xnheap *heap, void *membase, u32 size)</td></tr>
<tr class="memdesc:ga3772bba609e1cd11cb1a5d783113a6aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a memory heap.  <a href="#ga3772bba609e1cd11cb1a5d783113a6aa">More...</a><br /></td></tr>
<tr class="separator:ga3772bba609e1cd11cb1a5d783113a6aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadfd3dd9f371b5e19dcf106e75af1dcf9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cobalt__core__heap.html#gadfd3dd9f371b5e19dcf106e75af1dcf9">xnheap_set_name</a> (struct xnheap *heap, const char *name,...)</td></tr>
<tr class="memdesc:gadfd3dd9f371b5e19dcf106e75af1dcf9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the heap's name string.  <a href="#gadfd3dd9f371b5e19dcf106e75af1dcf9">More...</a><br /></td></tr>
<tr class="separator:gadfd3dd9f371b5e19dcf106e75af1dcf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga01d9244e1b1679044c3609542000aa35"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cobalt__core__heap.html#ga01d9244e1b1679044c3609542000aa35">xnheap_destroy</a> (struct xnheap *heap)</td></tr>
<tr class="memdesc:ga01d9244e1b1679044c3609542000aa35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroys a memory heap.  <a href="#ga01d9244e1b1679044c3609542000aa35">More...</a><br /></td></tr>
<tr class="separator:ga01d9244e1b1679044c3609542000aa35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaa0850d61e5171f23b1cee7c061c9384"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cobalt__core__heap.html#gaaa0850d61e5171f23b1cee7c061c9384">xnheap_alloc</a> (struct xnheap *heap, u32 size)</td></tr>
<tr class="memdesc:gaaa0850d61e5171f23b1cee7c061c9384"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a memory block from a memory heap.  <a href="#gaaa0850d61e5171f23b1cee7c061c9384">More...</a><br /></td></tr>
<tr class="separator:gaaa0850d61e5171f23b1cee7c061c9384"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0122042832915639a762e0b1a4a6eff1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cobalt__core__heap.html#ga0122042832915639a762e0b1a4a6eff1">xnheap_free</a> (struct xnheap *heap, void *block)</td></tr>
<tr class="memdesc:ga0122042832915639a762e0b1a4a6eff1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release a block to a memory heap.  <a href="#ga0122042832915639a762e0b1a4a6eff1">More...</a><br /></td></tr>
<tr class="separator:ga0122042832915639a762e0b1a4a6eff1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The implementation of the memory allocator follows the algorithm described in a USENIX 1988 paper called "Design of a General
 Purpose Memory Allocator for the 4.3BSD Unix Kernel" by Marshall K. </p>
<p>McKusick and Michael J. Karels. You can find it at various locations on the net, including <a href="http://docs.FreeBSD.org/44doc/papers/kernmalloc.pdf">http://docs.FreeBSD.org/44doc/papers/kernmalloc.pdf</a>.</p>
<dl class="section user"><dt>Implementation constraints</dt><dd></dd></dl>
<ul>
<li>Minimum page size is 2 ** XNHEAP_MINLOG2 (must be large enough to hold a pointer).</li>
<li>Maximum page size is 2 ** XNHEAP_MAXLOG2.</li>
<li>Requested block size is rounded up to XNHEAP_MINLOG2.</li>
<li>Requested block size larger than 2 times the XNHEAP_PAGESZ is rounded up to the next page boundary and obtained from the free page list. So we need a bucket for each power of two between XNHEAP_MINLOG2 and XNHEAP_MAXLOG2 inclusive, plus one to honor requests ranging from the maximum page size to twice this size. </li>
</ul>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaaa0850d61e5171f23b1cee7c061c9384"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * xnheap_alloc </td>
          <td>(</td>
          <td class="paramtype">struct xnheap *&#160;</td>
          <td class="paramname"><em>heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a memory block from a memory heap. </p>
<p>Allocates a contiguous region of memory from an active memory heap. Such allocation is guaranteed to be time-bounded.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>The descriptor address of the heap to get memory from.</td></tr>
    <tr><td class="paramname">size</td><td>The size in bytes of the requested block. Sizes lower or equal to the page size are rounded either to the minimum allocation size if lower than this value, or to the minimum alignment size if greater or equal to this value. In the current implementation, with MINALLOC = 8 and MINALIGN = 16, a 7 bytes request will be rounded to 8 bytes, and a 17 bytes request will be rounded to 32.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The address of the allocated region upon success, or NULL if no memory is available from the specified heap.</dd></dl>
<dl class="section user"><dt>Tags</dt><dd><a class="el" href="group__cobalt__core.html">unrestricted</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ga01d9244e1b1679044c3609542000aa35"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void xnheap_destroy </td>
          <td>(</td>
          <td class="paramtype">struct xnheap *&#160;</td>
          <td class="paramname"><em>heap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroys a memory heap. </p>
<p>Destroys a memory heap.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>The heap descriptor.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Tags</dt><dd><a class="el" href="group__cobalt__core.html">secondary-only</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ga0122042832915639a762e0b1a4a6eff1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void xnheap_free </td>
          <td>(</td>
          <td class="paramtype">struct xnheap *&#160;</td>
          <td class="paramname"><em>heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release a block to a memory heap. </p>
<p>Releases a memory block to a heap.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>The heap descriptor.</td></tr>
    <tr><td class="paramname">block</td><td>The block to be returned to the heap.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Tags</dt><dd><a class="el" href="group__cobalt__core.html">unrestricted</a> </dd></dl>

</div>
</div>
<a class="anchor" id="ga3772bba609e1cd11cb1a5d783113a6aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int xnheap_init </td>
          <td>(</td>
          <td class="paramtype">struct xnheap *&#160;</td>
          <td class="paramname"><em>heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>membase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a memory heap. </p>
<p>Initializes a memory heap suitable for time-bounded allocation requests of dynamic memory.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>The address of a heap descriptor to initialize.</td></tr>
    <tr><td class="paramname">membase</td><td>The address of the storage area.</td></tr>
    <tr><td class="paramname">size</td><td>The size in bytes of the storage area. <em>size</em> must be a multiple of PAGE_SIZE and smaller than 2 Gb in the current implementation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 is returned upon success, or:</dd></dl>
<ul>
<li>-EINVAL is returned if <em>size</em> is either:<ul>
<li>not aligned on PAGE_SIZE</li>
<li>smaller than 2 * PAGE_SIZE</li>
<li>greater than 2 Gb (XNHEAP_MAXHEAPSZ)</li>
</ul>
</li>
<li>-ENOMEM is returned upon failure of allocating the meta-data area used internally to maintain the heap.</li>
</ul>
<dl class="section user"><dt>Tags</dt><dd><a class="el" href="group__cobalt__core.html">secondary-only</a> </dd></dl>

</div>
</div>
<a class="anchor" id="gadfd3dd9f371b5e19dcf106e75af1dcf9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void xnheap_set_name </td>
          <td>(</td>
          <td class="paramtype">struct xnheap *&#160;</td>
          <td class="paramname"><em>heap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the heap's name string. </p>
<p>Set the heap name that will be used in statistic outputs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">heap</td><td>The address of a heap descriptor.</td></tr>
    <tr><td class="paramname">name</td><td>Name displayed in statistic outputs. This parameter can be a printk()-like format argument list.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>Tags</dt><dd><a class="el" href="group__cobalt__core.html">task-unrestricted</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
