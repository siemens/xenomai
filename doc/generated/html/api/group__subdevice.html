<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Xenomai API: Subdevice management services</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Subdevice management services<br>
<small>
[<a class="el" href="group__driverfacilities.html">Driver API.</a>]</small>
</h1>
<p>
<div class="dynheader">
Collaboration diagram for Subdevice management services:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__subdevice.png" border="0" alt="" usemap="#group____subdevice_map">
<map name="group____subdevice_map">
<area shape="rect" href="group__driverfacilities.html" title="Driver API." alt="" coords="7,5,97,32"></map></td></tr></table></center>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcomedi__subdevice.html">comedi_subdevice</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure describing the subdevice.  <a href="structcomedi__subdevice.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g17991e69f212d34918a84ad6f19b0dad">comedi_add_subd</a> (<a class="el" href="structcomedi__driver.html">comedi_drv_t</a> *drv, <a class="el" href="structcomedi__subdevice.html">comedi_subd_t</a> *subd)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a subdevice to the driver descriptor.  <a href="#g17991e69f212d34918a84ad6f19b0dad"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gf4e936e55a42bf1076c9ef65468e9f53">comedi_get_nbchan</a> (comedi_dev_t *dev, int subd_key)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the channels count registered on a specific subdevice.  <a href="#gf4e936e55a42bf1076c9ef65468e9f53"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Subdevices types</h2></td></tr>
<tr><td colspan="2">Flags to define the subdevice type<p>
<a class="anchor" name="COMEDI_SUBD_xxx"></a> <br><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="g61f461f011fc27b10f297af666ca264f"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_UNUSED" ref="g61f461f011fc27b10f297af666ca264f" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g61f461f011fc27b10f297af666ca264f">COMEDI_SUBD_UNUSED</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x1)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unused subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="g4eb969ec6756edb622b5dac3f4cb8a55"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_AI" ref="g4eb969ec6756edb622b5dac3f4cb8a55" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g4eb969ec6756edb622b5dac3f4cb8a55">COMEDI_SUBD_AI</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_READ|0x2)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Analog input subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="gcc737ec2760404aed3e2dbea8b9b6bf3"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_AO" ref="gcc737ec2760404aed3e2dbea8b9b6bf3" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gcc737ec2760404aed3e2dbea8b9b6bf3">COMEDI_SUBD_AO</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_WRITE|0x4)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Analog output subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="g335de91ceb769d96063d670c1d0dbf14"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_DI" ref="g335de91ceb769d96063d670c1d0dbf14" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g335de91ceb769d96063d670c1d0dbf14">COMEDI_SUBD_DI</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_READ|0x8)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Digital input subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="g2b34365739de915ce20f5f32ccd419a1"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_DO" ref="g2b34365739de915ce20f5f32ccd419a1" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g2b34365739de915ce20f5f32ccd419a1">COMEDI_SUBD_DO</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_WRITE|0x10)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Digital output subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="g6146c785477852594f00f4f0f4de5bf4"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_DIO" ref="g6146c785477852594f00f4f0f4de5bf4" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g6146c785477852594f00f4f0f4de5bf4">COMEDI_SUBD_DIO</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x20)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Digital input/output subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="gcbf136049bc1a900163a254d588d1af3"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_COUNTER" ref="gcbf136049bc1a900163a254d588d1af3" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gcbf136049bc1a900163a254d588d1af3">COMEDI_SUBD_COUNTER</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x40)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Counter subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="gd317936df9818a69520872f550e811c9"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_TIMER" ref="gd317936df9818a69520872f550e811c9" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gd317936df9818a69520872f550e811c9">COMEDI_SUBD_TIMER</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x80)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Timer subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="g781ad0e553cc6383f2dec8caff875839"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_MEMORY" ref="g781ad0e553cc6383f2dec8caff875839" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g781ad0e553cc6383f2dec8caff875839">COMEDI_SUBD_MEMORY</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x100)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Memory, EEPROM, DPRAM. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="g6450e472633ae87b94e0d6293fb73070"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_CALIB" ref="g6450e472633ae87b94e0d6293fb73070" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#g6450e472633ae87b94e0d6293fb73070">COMEDI_SUBD_CALIB</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x200)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calibration subdevice DACs. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="gbf122bc3670138369bcd8bca808836b3"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_PROC" ref="gbf122bc3670138369bcd8bca808836b3" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gbf122bc3670138369bcd8bca808836b3">COMEDI_SUBD_PROC</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x400)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Processor, DSP. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="gf4d277cfe19cea4e452e2bf6744d86f9"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_SERIAL" ref="gf4d277cfe19cea4e452e2bf6744d86f9" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gf4d277cfe19cea4e452e2bf6744d86f9">COMEDI_SUBD_SERIAL</a>&nbsp;&nbsp;&nbsp;(COMEDI_SUBD_MASK_SPECIAL|0x800)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Serial IO subdevice. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="gd72bb066a073ac8b7cdd5a2860014b1a"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_TYPES" ref="gd72bb066a073ac8b7cdd5a2860014b1a" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gd72bb066a073ac8b7cdd5a2860014b1a">COMEDI_SUBD_TYPES</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mask which gathers all the types. <br></td></tr>
<tr><td colspan="2"><br><h2>Subdevice features</h2></td></tr>
<tr><td colspan="2">Flags to define the subdevice's capabilities<p>
<a class="anchor" name="COMEDI_SUBD_FT_xxx"></a> <br><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="gd5f561feddd1a076c430c78452baa8e1"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_CMD" ref="gd5f561feddd1a076c430c78452baa8e1" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#gd5f561feddd1a076c430c78452baa8e1">COMEDI_SUBD_CMD</a>&nbsp;&nbsp;&nbsp;0x1000</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The subdevice can handle command (i.e it can perform asynchronous acquisition). <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ge92928cf8a5d9bea282702e20e68de71"></a><!-- doxytag: member="subdevice::COMEDI_SUBD_MMAP" ref="ge92928cf8a5d9bea282702e20e68de71" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__subdevice.html#ge92928cf8a5d9bea282702e20e68de71">COMEDI_SUBD_MMAP</a>&nbsp;&nbsp;&nbsp;0x8000</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The subdevice support mmap operations (technically, any driver can do it; however, the developer might want that his driver must be accessed through read / write. <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Subdevice declaration in a driver<p>
The subdevice structure is the most complex one in the Comedi driver layer. It contains some description fields to fill and some callbacks to declare.<p>
The description fields are:<ul>
<li>flags: to define the subdevice type and its capabilities;</li><li>chan_desc: to describe the channels which compose the subdevice;</li><li>rng_desc: to declare the usable ranges;</li></ul>
<p>
The functions callbakcs are:<ul>
<li>do_cmd() and do_cmdtest(): to performe asynchronous acquisitions thanks to commands;</li><li>cancel(): to abort a working asynchronous acquisition;</li><li>munge(): to apply modifications on the data freshly acquired during an asynchronous transfer. Warning: using this feature with can significantly reduce the performances (if the munge operation is complex, it will trigger high CPU charge and if the acquisition device is DMA capable, many cache-misses and cache-replaces will occur (the benefits of the DMA controller will vanish);</li><li>trigger(): optionnaly to launch an asynchronous acquisition;</li><li>insn_read(), insn_write(), insn_bits(), insn_config(): to perform synchronous acquisition operations.</li></ul>
<p>
Once the subdevice is filled, it must be inserted into the driver structure thanks to <a class="el" href="group__subdevice.html#g17991e69f212d34918a84ad6f19b0dad" title="Add a subdevice to the driver descriptor.">comedi_add_subd()</a>. <hr><h2>Function Documentation</h2>
<a class="anchor" name="g17991e69f212d34918a84ad6f19b0dad"></a><!-- doxytag: member="driver_facilities.c::comedi_add_subd" ref="g17991e69f212d34918a84ad6f19b0dad" args="(comedi_drv_t *drv, comedi_subd_t *subd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int comedi_add_subd           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcomedi__driver.html">comedi_drv_t</a> *&nbsp;</td>
          <td class="paramname"> <em>drv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structcomedi__subdevice.html">comedi_subd_t</a> *&nbsp;</td>
          <td class="paramname"> <em>subd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add a subdevice to the driver descriptor. 
<p>
Once the driver descriptor structure is initialized, the function <a class="el" href="group__subdevice.html#g17991e69f212d34918a84ad6f19b0dad" title="Add a subdevice to the driver descriptor.">comedi_add_subd()</a> must be used so to add some subdevices to the driver.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>drv</em>&nbsp;</td><td>Driver descriptor structure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>subd</em>&nbsp;</td><td>Subdevice descriptor structure</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the index with which the subdevice has been registered, in case of error a negative error code is returned. </dd></dl>

</div>
</div><p>
<a class="anchor" name="gf4e936e55a42bf1076c9ef65468e9f53"></a><!-- doxytag: member="driver_facilities.c::comedi_get_nbchan" ref="gf4e936e55a42bf1076c9ef65468e9f53" args="(comedi_dev_t *dev, int subd_key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int comedi_get_nbchan           </td>
          <td>(</td>
          <td class="paramtype">comedi_dev_t *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>subd_key</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get the channels count registered on a specific subdevice. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dev</em>&nbsp;</td><td>Device descriptor structure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>subd_key</em>&nbsp;</td><td>Subdevice index</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, otherwise negative error code. </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Sep 1 11:25:24 2009 for Xenomai API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
