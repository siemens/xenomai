<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Xenomai API: include/rtdm/rtdm.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">rtdm</a></div>
<h1>rtdm.h</h1><a href="rtdm_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00035 <span class="preprocessor">#ifndef _RTDM_H</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define _RTDM_H</span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#ifdef __KERNEL__</span>
00039 <span class="preprocessor"></span>
00040 <span class="preprocessor">#include &lt;linux/fcntl.h&gt;</span>
00041 <span class="preprocessor">#include &lt;linux/ioctl.h&gt;</span>
00042 <span class="preprocessor">#include &lt;linux/sched.h&gt;</span>
00043 <span class="preprocessor">#include &lt;linux/socket.h&gt;</span>
00044 
00045 <span class="keyword">typedef</span> size_t                      socklen_t;
00046 <span class="keyword">typedef</span> <span class="keyword">struct </span>task_struct          rtdm_user_info_t;
00047 
00048 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00049 
00050 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00051 <span class="preprocessor">#include &lt;inttypes.h&gt;</span>
00052 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
00053 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
00054 
00055 <span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ */</span>
00056 
00057 
<a name="l00059"></a><a class="code" href="rtdm_8h.html#a0">00059</a> <span class="preprocessor">#define RTDM_MAX_DEVNAME_LEN        31</span>
00060 <span class="preprocessor"></span>
00061 
00066 <span class="preprocessor">#define RTDM_CLASS_PARPORT          1</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_SERIAL           2</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_CAN              3</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_NETWORK          4</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_RTMAC            5</span>
00071 <span class="preprocessor"></span><span class="comment">/*</span>
00072 <span class="comment">#define RTDM_CLASS_USB              ?</span>
00073 <span class="comment">#define RTDM_CLASS_FIREWIRE         ?</span>
00074 <span class="comment">#define RTDM_CLASS_INTERBUS         ?</span>
00075 <span class="comment">#define RTDM_CLASS_PROFIBUS         ?</span>
00076 <span class="comment">#define ...</span>
00077 <span class="comment">*/</span>
00078 <span class="preprocessor">#define RTDM_CLASS_EXPERIMENTAL     224</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_MAX              255</span>
00080 <span class="preprocessor"></span>
00083 <span class="preprocessor">#define RTIOC_TYPE_COMMON           0</span>
00084 <span class="preprocessor"></span>
00085 
<a name="l00095"></a><a class="code" href="rtdm_8h.html#a9">00095</a> <span class="preprocessor">#define RTIOC_PURGE                 _IOW(RTIOC_TYPE_COMMON, 0x10, int)</span>
00096 <span class="preprocessor"></span>
00102 <span class="preprocessor">#define RTDM_PURGE_RX_BUFFER        0x0001</span>
00103 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_PURGE_TX_BUFFER        0x0002</span>
00104 <span class="preprocessor"></span>
00107 <span class="comment">/* Internally used for mapping socket functions on IOCTLs */</span>
00108 <span class="keyword">struct </span>_rtdm_getsockopt_args {
00109     <span class="keywordtype">int</span>                             level;
00110     <span class="keywordtype">int</span>                             optname;
00111     <span class="keywordtype">void</span>                            *optval;
00112     socklen_t                       *optlen;
00113 };
00114 
00115 <span class="keyword">struct </span>_rtdm_setsockopt_args {
00116     <span class="keywordtype">int</span>                             level;
00117     <span class="keywordtype">int</span>                             optname;
00118     <span class="keyword">const</span> <span class="keywordtype">void</span>                      *optval;
00119     socklen_t                       optlen;
00120 };
00121 
00122 <span class="keyword">struct </span>_rtdm_getsockaddr_args {
00123     <span class="keyword">struct </span>sockaddr                 *addr;
00124     socklen_t                       *addrlen;
00125 };
00126 
00127 <span class="keyword">struct </span>_rtdm_setsockaddr_args {
00128     <span class="keyword">const</span> <span class="keyword">struct </span>sockaddr           *addr;
00129     socklen_t                       addrlen;
00130 };
00131 
00132 <span class="preprocessor">#define _RTIOC_GETSOCKOPT          _IOW(RTIOC_TYPE_COMMON, 0x20,        \</span>
00133 <span class="preprocessor">                                        struct _rtdm_getsockopt_args)</span>
00134 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_SETSOCKOPT          _IOW(RTIOC_TYPE_COMMON, 0x21,        \</span>
00135 <span class="preprocessor">                                        struct _rtdm_setsockopt_args)</span>
00136 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_BIND                _IOW(RTIOC_TYPE_COMMON, 0x22,        \</span>
00137 <span class="preprocessor">                                        struct _rtdm_setsockaddr_args)</span>
00138 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_CONNECT             _IOW(RTIOC_TYPE_COMMON, 0x23,        \</span>
00139 <span class="preprocessor">                                        struct _rtdm_setsockaddr_args)</span>
00140 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_LISTEN              _IOW(RTIOC_TYPE_COMMON, 0x24,        \</span>
00141 <span class="preprocessor">                                        int)</span>
00142 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_ACCEPT              _IOW(RTIOC_TYPE_COMMON, 0x25,        \</span>
00143 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00144 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_GETSOCKNAME         _IOW(RTIOC_TYPE_COMMON, 0x26,        \</span>
00145 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00146 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_GETPEERNAME         _IOW(RTIOC_TYPE_COMMON, 0x27,        \</span>
00147 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00148 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_SHUTDOWN            _IOW(RTIOC_TYPE_COMMON, 0x28,        \</span>
00149 <span class="preprocessor">                                        int)</span>
00150 <span class="preprocessor"></span>
00151 
00152 <span class="preprocessor">#ifdef __KERNEL__</span>
00153 <span class="preprocessor"></span><span class="keywordtype">int</span>     _rtdm_open   (rtdm_user_info_t *user_info, <span class="keyword">const</span> <span class="keywordtype">char</span> *path,
00154                       <span class="keywordtype">int</span> oflag);
00155 <span class="keywordtype">int</span>     _rtdm_socket (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> protocol_family,
00156                       <span class="keywordtype">int</span> socket_type, <span class="keywordtype">int</span> protocol);
00157 <span class="keywordtype">int</span>     _rtdm_close  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> forced);
00158 <span class="keywordtype">int</span>     _rtdm_ioctl  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> request, ...);
00159 ssize_t _rtdm_read   (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf,
00160                       size_t nbyte);
00161 ssize_t _rtdm_write  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf,
00162                       size_t nbyte);
00163 ssize_t _rtdm_recvmsg(rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keyword">struct</span> msghdr *msg,
00164                       <span class="keywordtype">int</span> flags);
00165 ssize_t _rtdm_sendmsg(rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd,
00166                       <span class="keyword">const</span> <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00167 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00168 
00169 
00170 <span class="comment">/* Define RTDM_NO_DEFAULT_USER_API to switch off the default rt_dev_xxx</span>
00171 <span class="comment"> * interface when providing a customised user API */</span>
00172 <span class="preprocessor">#ifndef RTDM_NO_DEFAULT_USER_API</span>
00173 <span class="preprocessor"></span>
00174 <span class="preprocessor">#ifdef __KERNEL__</span>
00175 <span class="preprocessor"></span>
00176 <span class="preprocessor">#define rt_dev_open(path, oflag, ...)                           \</span>
00177 <span class="preprocessor">    _rtdm_open(NULL, path, oflag)</span>
00178 <span class="preprocessor"></span>
00179 <span class="preprocessor">#define rt_dev_socket(protocol_family, socket_type, protocol)   \</span>
00180 <span class="preprocessor">    _rtdm_socket(NULL, protocol_family, socket_type, protocol)</span>
00181 <span class="preprocessor"></span>
00182 <span class="preprocessor">#define rt_dev_close(fd)                                        \</span>
00183 <span class="preprocessor">    _rtdm_close(NULL, fd, 0)</span>
00184 <span class="preprocessor"></span>
00185 <span class="preprocessor">#define rt_dev_ioctl(fd, request, ...)                          \</span>
00186 <span class="preprocessor">    _rtdm_ioctl(NULL, fd, request, __VA_ARGS__)</span>
00187 <span class="preprocessor"></span>
00188 <span class="preprocessor">#define rt_dev_read(fd, buf, nbyte)                             \</span>
00189 <span class="preprocessor">    _rtdm_read(NULL, fd, buf, nbyte)</span>
00190 <span class="preprocessor"></span>
00191 <span class="preprocessor">#define rt_dev_write(fd, buf, nbyte)                            \</span>
00192 <span class="preprocessor">    _rtdm_write(NULL, fd, buf, nbyte)</span>
00193 <span class="preprocessor"></span>
00194 <span class="preprocessor">#define rt_dev_recvmsg(fd, msg, flags)                          \</span>
00195 <span class="preprocessor">    _rtdm_recvmsg(NULL, fd, msg, flags)</span>
00196 <span class="preprocessor"></span>
00197 <span class="preprocessor">#define rt_dev_sendmsg(fd, msg, flags)                          \</span>
00198 <span class="preprocessor">    _rtdm_sendmsg(NULL, fd, msg, flags)</span>
00199 <span class="preprocessor"></span>
00200 
00201 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_recvfrom(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags,
00202                                       <span class="keyword">struct</span> sockaddr *from,
00203                                       socklen_t *fromlen)
00204 {
00205     <span class="keyword">struct </span>iovec    iov = {buf, len};
00206     <span class="keyword">struct </span>msghdr   msg =
00207         {from, (from != NULL) ? *fromlen : 0, &amp;iov, 1, NULL, 0};
00208     <span class="keywordtype">int</span>             ret;
00209 
00210     ret = rt_dev_recvmsg(fd, &amp;msg, flags);
00211     <span class="keywordflow">if</span> ((ret &gt;= 0) &amp;&amp; (from != NULL))
00212         *fromlen = msg.msg_namelen;
00213     <span class="keywordflow">return</span> ret;
00214 }
00215 
00216 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00217 
00218 <span class="preprocessor">#ifdef __cplusplus</span>
00219 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00220 <span class="preprocessor">#endif</span>
00221 <span class="preprocessor"></span>
00222 <span class="keywordtype">int</span>     rt_dev_open   (<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> oflag, ...);
00223 <span class="keywordtype">int</span>     rt_dev_socket (<span class="keywordtype">int</span> protocol_family, <span class="keywordtype">int</span> socket_type, <span class="keywordtype">int</span> protocol);
00224 <span class="keywordtype">int</span>     rt_dev_close  (<span class="keywordtype">int</span> fd);
00225 <span class="keywordtype">int</span>     rt_dev_ioctl  (<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> request, ...);
00226 ssize_t rt_dev_read   (<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t nbyte);
00227 ssize_t rt_dev_write  (<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t nbyte);
00228 ssize_t rt_dev_recvmsg(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00229 ssize_t rt_dev_sendmsg(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00230 
00231 ssize_t rt_dev_recvfrom(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags,
00232                         <span class="keyword">struct</span> sockaddr *from,
00233                         socklen_t *fromlen);
00234 
00235 <span class="preprocessor">#ifdef __cplusplus</span>
00236 <span class="preprocessor"></span>}
00237 <span class="preprocessor">#endif</span>
00238 <span class="preprocessor"></span>
00239 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00240 
00241 <span class="preprocessor">#ifdef __cplusplus</span>
00242 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00243 <span class="preprocessor">#endif</span>
00244 <span class="preprocessor"></span>
00245 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_recv(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags)
00246 {
00247     <span class="keywordflow">return</span> rt_dev_recvfrom(fd, buf, len, flags, NULL, NULL);
00248 }
00249 
00250 
00251 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_sendto(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t len,
00252                                     <span class="keywordtype">int</span> flags, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *to,
00253                                     socklen_t tolen)
00254 {
00255     <span class="keyword">struct </span>iovec    iov = {(<span class="keywordtype">void</span> *)buf, len};
00256     <span class="keyword">struct </span>msghdr   msg =
00257         {(<span class="keyword">struct </span>sockaddr *)to, tolen, &amp;iov, 1, NULL, 0};
00258 
00259     <span class="keywordflow">return</span> rt_dev_sendmsg(fd, &amp;msg, flags);
00260 }
00261 
00262 
00263 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_send(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t len,
00264                                   <span class="keywordtype">int</span> flags)
00265 {
00266     <span class="keywordflow">return</span> rt_dev_sendto(fd, buf, len, flags, NULL, 0);
00267 }
00268 
00269 
00270 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_getsockopt(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname,
00271                                     <span class="keywordtype">void</span> *optval, socklen_t *optlen)
00272 {
00273     <span class="keyword">struct </span>_rtdm_getsockopt_args args = {level, optname, optval, optlen};
00274 
00275     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_GETSOCKOPT, &amp;args);
00276 }
00277 
00278 
00279 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_setsockopt(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname,
00280                                     <span class="keyword">const</span> <span class="keywordtype">void</span> *optval, socklen_t optlen)
00281 {
00282     <span class="keyword">struct </span>_rtdm_setsockopt_args args =
00283     {level, optname, (<span class="keywordtype">void</span> *)optval, optlen};
00284 
00285     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_SETSOCKOPT, &amp;args);
00286 }
00287 
00288 
00289 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_bind(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *my_addr,
00290                               socklen_t addrlen)
00291 {
00292     <span class="keyword">struct </span>_rtdm_setsockaddr_args args = {my_addr, addrlen};
00293 
00294     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_BIND, &amp;args);
00295 }
00296 
00297 
00298 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_connect(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *serv_addr,
00299                                  socklen_t addrlen)
00300 {
00301     <span class="keyword">struct </span>_rtdm_setsockaddr_args args = {serv_addr, addrlen};
00302 
00303     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_CONNECT, &amp;args);
00304 }
00305 
00306 
00307 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_listen(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> backlog)
00308 {
00309     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_LISTEN, backlog);
00310 }
00311 
00312 
00313 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_accept(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *addr,
00314                                 socklen_t *addrlen)
00315 {
00316     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {addr, addrlen};
00317 
00318     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_ACCEPT, &amp;args);
00319 }
00320 
00321 
00322 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_getsockname(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *name,
00323                                      socklen_t *namelen)
00324 {
00325     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {name, namelen};
00326 
00327     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_GETSOCKNAME, &amp;args);
00328 }
00329 
00330 
00331 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_getpeername(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *name,
00332                                      socklen_t *namelen)
00333 {
00334     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {name, namelen};
00335 
00336     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_GETPEERNAME, &amp;args);
00337 }
00338 
00339 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_shutdown(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> how)
00340 {
00341     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_SHUTDOWN, how);
00342 }
00343 
00344 <span class="preprocessor">#ifdef __cplusplus</span>
00345 <span class="preprocessor"></span>}
00346 <span class="preprocessor">#endif</span>
00347 <span class="preprocessor"></span>
00348 <span class="preprocessor">#endif </span><span class="comment">/* RTDM_NO_DEFAULT_USER_API */</span>
00349 
00350 <span class="preprocessor">#endif </span><span class="comment">/* _RTDM_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Dec 5 17:17:21 2005 for Xenomai API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
